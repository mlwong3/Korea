<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ“æ–‡å½±åƒç¿»è­¯ç¥å™¨</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fade-in 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                        'slide-up': 'slide-up 0.5s cubic-bezier(0.4, 0, 0.2, 1)',
                        'shake': 'shake 0.3s ease-in-out',
                        'spin-slow': 'spin 3s linear infinite',
                    },
                    keyframes: {
                        'fade-in': {
                            'from': { opacity: '0', transform: 'scale(0.98)' },
                            'to': { opacity: '1', transform: 'scale(1)' }
                        },
                        'slide-up': {
                            'from': { transform: 'translateY(20px)', opacity: '0' },
                            'to': { transform: 'translateY(0)', opacity: '1' }
                        },
                        'shake': {
                            '0%, 100%': { transform: 'translateX(0)' },
                            '25%': { transform: 'translateX(-4px)' },
                            '75%': { transform: 'translateX(4px)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #c7c7c7; 
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8; 
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // --- Icons Components (Replacing lucide-react imports) ---
        const IconBase = ({ children, className }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width="24" 
                height="24" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const Camera = ({ className }) => (
            <IconBase className={className}>
                <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path>
                <circle cx="12" cy="13" r="3"></circle>
            </IconBase>
        );

        const Upload = ({ className }) => (
            <IconBase className={className}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </IconBase>
        );

        const X = ({ className }) => (
            <IconBase className={className}>
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </IconBase>
        );

        const Check = ({ className }) => (
            <IconBase className={className}>
                <polyline points="20 6 9 17 4 12"></polyline>
            </IconBase>
        );

        const Globe = ({ className }) => (
            <IconBase className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="2" y1="12" x2="22" y2="12"></line>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
            </IconBase>
        );

        const RefreshCw = ({ className }) => (
            <IconBase className={className}>
                <path d="M23 4v6h-6"></path>
                <path d="M1 20v-6h6"></path>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
            </IconBase>
        );

        const ChevronRight = ({ className }) => (
            <IconBase className={className}>
                <polyline points="9 18 15 12 9 6"></polyline>
            </IconBase>
        );

        const Zap = ({ className }) => (
            <IconBase className={className}>
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
            </IconBase>
        );

        const ImageIcon = ({ className }) => (
            <IconBase className={className}>
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
            </IconBase>
        );

        const Table = ({ className }) => (
            <IconBase className={className}>
                <path d="M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18"></path>
            </IconBase>
        );

        const Settings = ({ className }) => (
            <IconBase className={className}>
                <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>
                <circle cx="12" cy="12" r="3"></circle>
            </IconBase>
        );

        const Info = ({ className }) => (
            <IconBase className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </IconBase>
        );

        // --- Main App Component ---
        function App() {
            const [apiKey, setApiKey] = useState('');
            const [baseUrl, setBaseUrl] = useState('https://generativelanguage.googleapis.com');
            const [showSettings, setShowSettings] = useState(false);
            const [imgSrc, setImgSrc] = useState(null);
            const [isCameraOpen, setIsCameraOpen] = useState(false);
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState(null);
            const [isDemoMode, setIsDemoMode] = useState(false);
            const videoRef = useRef(null);
            const streamRef = useRef(null);

            // --- ç›¸æ©ŸåŠŸèƒ½ ---
            const startCamera = async () => {
                try {
                setError(null);
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' }
                });
                streamRef.current = stream;
                if (videoRef.current) {
                    videoRef.current.srcObject = stream;
                }
                setIsCameraOpen(true);
                } catch (err) {
                setError("ç„¡æ³•å­˜å–ç›¸æ©Ÿï¼Œè«‹æª¢æŸ¥æ¬Šé™æˆ–ä½¿ç”¨ä¸Šå‚³åœ–ç‰‡åŠŸèƒ½ã€‚");
                }
            };

            const stopCamera = () => {
                if (streamRef.current) {
                streamRef.current.getTracks().forEach(track => track.stop());
                streamRef.current = null;
                }
                setIsCameraOpen(false);
            };

            const captureImage = () => {
                if (videoRef.current) {
                const canvas = document.createElement('canvas');
                canvas.width = videoRef.current.videoWidth;
                canvas.height = videoRef.current.videoHeight;
                canvas.getContext('2d').drawImage(videoRef.current, 0, 0);
                setImgSrc(canvas.toDataURL('image/jpeg'));
                stopCamera();
                }
            };

            // --- ä¸Šå‚³åŠŸèƒ½ ---
            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                const reader = new FileReader();
                reader.onloadend = () => {
                    setImgSrc(reader.result);
                    setError(null);
                };
                reader.readAsDataURL(file);
                }
            };

            // --- æ¨¡æ“¬æ•¸æ“š (Mock Data) ---
            const mockAnalyze = async () => {
                return new Promise((resolve) => {
                setTimeout(() => {
                    resolve(`### ğŸ“¸ åœ–ç‰‡åˆ†æçµæœ (æ¸¬è©¦æ¨¡å¼)
é€™ä¼¼ä¹æ˜¯ä¸€å¼µéŸ“å¼é¤å»³çš„èœå–®ã€‚ä»¥ä¸‹æ˜¯ç‚ºæ‚¨ç¿»è­¯çš„å…§å®¹èˆ‡æ•´ç†ï¼š

**åœ–ç‰‡æ‘˜è¦ï¼š**
é€™æ˜¯ä¸€ä»½å…¸å‹çš„éŸ“å¼çƒ¤è‚‰åº—èœå–®ï¼ŒåŒ…å«äº†è‚‰é¡ä¸»é£Ÿèˆ‡å¹¾ç¨®å¸¸è¦‹çš„é…é¤å’Œé£²æ–™ã€‚

**é‡é»æ‘˜è¦è¡¨æ ¼ï¼š**

| é …ç›®/åŸæ–‡é—œéµå­— | ä¸­æ–‡èªªæ˜ | å‚™è¨» (éŸ“å…ƒ/èªªæ˜) |
| :--- | :--- | :--- |
| **ì‚¼ê²¹ì‚´** (Samgyeopsal) | äº”èŠ±è‚‰ | 15,000 KRW (180g) |
| **ëª©ì‚´** (Moksal) | è±¬é ¸è‚‰/æ¢…èŠ±è‚‰ | 15,000 KRW (180g) |
| **í•œìš° ë“±ì‹¬** (Hanwoo Deungsim) | éŸ“ç‰›é‡Œè‚Œ | 38,000 KRW (150g) |
| **ê¹€ì¹˜ì°Œê°œ** (Kimchi Jjigae) | æ³¡èœé‹ | 7,000 KRW |
| **ê³µê¸°ë°¥** (Gonggibap) | ç™½é£¯ | 1,000 KRW |
| **ì†Œì£¼/ë§¥ì£¼** (Soju/Maekju) | ç‡’é…’/å•¤é…’ | 5,000 KRW |

**âš ï¸ æ³¨æ„äº‹é …ï¼š**
* è‚‰é¡é€šå¸¸ç‚º 2 äººä»½èµ·é»ã€‚
* æ­¤ç‚ºç³»çµ±æ¨¡æ“¬çš„æ¸¬è©¦çµæœï¼Œè‹¥è¦é€²è¡ŒçœŸå¯¦ç¿»è­¯ï¼Œè«‹åœ¨è¨­å®šä¸­è¼¸å…¥æœ‰æ•ˆçš„ API Keyã€‚`);
                }, 2000); 
                });
            };

            // --- AI åˆ†æåŠŸèƒ½ ---
            const analyzeImage = async () => {
                if (!imgSrc) return;

                setLoading(true);
                setError(null);
                setResult(null);

                // åˆ¤æ–·æ˜¯å¦ä½¿ç”¨ Demo æ¨¡å¼
                if (!apiKey) {
                setIsDemoMode(true);
                try {
                    const mockResult = await mockAnalyze();
                    setResult(mockResult);
                } catch (e) {
                    setError("æ¨¡æ“¬æ¸¬è©¦ç™¼ç”ŸéŒ¯èª¤");
                } finally {
                    setLoading(false);
                }
                return;
                }

                // çœŸå¯¦ API æ¨¡å¼
                setIsDemoMode(false);
                try {
                const base64Image = imgSrc.split(',')[1];
                
                const prompt = `
                    ä½ æ˜¯ä¸€å€‹ç²¾é€šéŸ“æ–‡èˆ‡ç¹é«”ä¸­æ–‡çš„å°ˆæ¥­ç¿»è­¯å“¡ã€‚
                    è«‹åˆ†æé€™å¼µåœ–ç‰‡ä¸­çš„éŸ“æ–‡å…§å®¹ï¼Œä¸¦åŸ·è¡Œä»¥ä¸‹å…©å€‹ä»»å‹™ï¼š
                    
                    1. **å…¨æ–‡ç¿»è­¯**ï¼šå°‡åœ–ç‰‡ä¸­çš„éŸ“æ–‡ç¿»è­¯æˆé€šé †çš„ç¹é«”ä¸­æ–‡ã€‚
                    2. **é‡é»æ‘˜è¦è¡¨æ ¼**ï¼šè«‹æ ¹æ“šå…§å®¹è£½ä½œä¸€å€‹Markdownè¡¨æ ¼ï¼Œæ¬„ä½åŒ…å«ã€Œé …ç›®/åŸæ–‡é—œéµå­—ã€ã€ã€Œä¸­æ–‡èªªæ˜ã€ã€ã€Œå‚™è¨»ï¼ˆå¦‚æœ‰é‡‘é¡ã€æ—¥æœŸæˆ–ç‰¹æ®Šæ³¨æ„äº‹é …ï¼‰ã€ã€‚
                    
                    è«‹ç›´æ¥è¼¸å‡º Markdown æ ¼å¼ã€‚
                `;

                const cleanBaseUrl = baseUrl.replace(/\/$/, '');
                // ä½¿ç”¨ gemini-2.5-flash
                const response = await fetch(`${cleanBaseUrl}/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                    contents: [{
                        parts: [
                        { text: prompt },
                        {
                            inlineData: {
                            mimeType: "image/jpeg",
                            data: base64Image
                            }
                        }
                        ]
                    }]
                    })
                });

                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error.message || "API å‘¼å«å¤±æ•—");
                }

                const textResult = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (textResult) {
                    setResult(textResult);
                } else {
                    throw new Error("ç„¡æ³•è¾¨è­˜åœ–ç‰‡å…§å®¹æˆ– AI æœªå›å‚³çµæœ");
                }

                } catch (err) {
                if (err.message.includes('User location is not supported')) {
                    setError("éŒ¯èª¤ï¼šæ‚¨çš„åœ°å€ä¸æ”¯æ´æ­¤ APIã€‚è«‹å˜—è©¦é–‹å•Ÿ VPN (é€£ç·šè‡³å°ç£/æ—¥æœ¬/ç¾åœ‹) æˆ–è¨­å®š Proxy URLã€‚");
                } else {
                    setError(err.message);
                }
                } finally {
                setLoading(false);
                }
            };

            const resetAll = () => {
                setImgSrc(null);
                setResult(null);
                setError(null);
                setIsCameraOpen(false);
            };

            // --- Markdown è¡¨æ ¼é¡¯ç¤ºçµ„ä»¶ ---
            const MarkdownDisplay = ({ content }) => {
                if (!content) return null;
                
                const lines = content.split('\n');
                
                return (
                <div className="prose prose-indigo max-w-none text-gray-800 whitespace-pre-wrap font-sans text-sm md:text-base">
                    {lines.map((line, i) => {
                    const trimmedLine = line.trim();
                    
                    // è™•ç†è¡¨æ ¼åˆ†éš”ç·š
                    if (trimmedLine.startsWith('|') && trimmedLine.includes('---')) return null;

                    // è™•ç†è¡¨æ ¼è¡Œ
                    if (trimmedLine.startsWith('|')) {
                        const cells = trimmedLine.split('|').filter(c => c.trim() !== '');
                        const isHeader = trimmedLine.includes('é …ç›®') || trimmedLine.includes('é—œéµå­—') || trimmedLine.includes('èªªæ˜');
                        
                        return (
                        <div key={i} className={`flex border-b border-gray-200 last:border-0 ${isHeader ? 'bg-indigo-100 font-bold text-indigo-900 rounded-t-lg mt-4' : 'hover:bg-gray-50'}`}>
                            {cells.map((cell, cellIdx) => (
                            <div key={cellIdx} className="flex-1 p-2 md:p-3 break-words">
                                {cell.replace(/\*\*/g, '').trim()}
                            </div>
                            ))}
                        </div>
                        );
                    }

                    // è™•ç†æ¨™é¡Œ
                    if (line.startsWith('###')) return <h3 key={i} className="text-lg font-bold text-indigo-800 mt-6 mb-2">{line.replace('###', '')}</h3>;
                    if (line.startsWith('##')) return <h2 key={i} className="text-xl font-bold text-indigo-900 mt-8 mb-4 border-b-2 border-indigo-100 pb-2">{line.replace('##', '')}</h2>;
                    
                    // è™•ç†ç²—é«”
                    if (line.includes('**')) {
                        const parts = line.split('**');
                        return (
                        <p key={i} className="mb-2">
                            {parts.map((part, idx) => (
                            idx % 2 === 1 ? <span key={idx} className="font-bold text-gray-900">{part}</span> : part
                            ))}
                        </p>
                        )
                    }

                    if (trimmedLine === '') return <div key={i} className="h-2"></div>;

                    return <p key={i} className="mb-1 leading-relaxed">{line}</p>;
                    })}
                </div>
                );
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 to-indigo-50 font-sans">
                <div className="max-w-md mx-auto bg-white min-h-screen shadow-2xl overflow-hidden flex flex-col relative">
                    
                    {/* Header */}
                    <header className="bg-indigo-600 text-white p-4 shadow-md flex justify-between items-center z-10 sticky top-0">
                    <div className="flex items-center gap-2">
                        <Globe className="w-5 h-5" />
                        <h1 className="text-lg font-bold tracking-wide">éŸ“æ–‡ç¿»è­¯ç¥å™¨</h1>
                    </div>
                    <button 
                        onClick={() => setShowSettings(!showSettings)}
                        className={`text-xs px-3 py-1.5 rounded-full transition-all flex items-center gap-1 ${apiKey ? 'bg-green-500 text-white' : 'bg-indigo-800 text-indigo-200'}`}
                    >
                        <Settings className="w-3 h-3" /> {apiKey ? 'å·²é€£ç·š' : 'è¨­å®š Key'}
                    </button>
                    </header>

                    {/* Settings Modal */}
                    {showSettings && (
                    <div className="absolute inset-0 bg-white/95 z-50 p-6 animate-fade-in flex flex-col">
                        <div className="flex justify-between items-center mb-6">
                        <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                            <Settings className="w-6 h-6 text-indigo-600" /> è¨­å®š
                        </h2>
                        <button onClick={() => setShowSettings(false)} className="p-2 bg-gray-100 rounded-full hover:bg-gray-200">
                            <X className="w-5 h-5 text-gray-600" />
                        </button>
                        </div>
                        
                        <div className="space-y-6 flex-1">
                        <div className="bg-blue-50 p-4 rounded-xl border border-blue-100">
                            <h3 className="text-sm font-bold text-blue-800 mb-2 flex items-center gap-2">
                            <Info className="w-4 h-4" /> æ¨¡å¼èªªæ˜
                            </h3>
                            <p className="text-xs text-blue-700 leading-relaxed">
                            ç›®å‰ç‹€æ…‹ï¼š<span className="font-bold">{apiKey ? 'âœ… çœŸå¯¦ AI æ¨¡å¼' : 'ğŸ§ª æ¨¡æ“¬æ¸¬è©¦æ¨¡å¼'}</span><br/>
                            è‹¥æœªè¼¸å…¥ Keyï¼Œç³»çµ±å°‡ä½¿ç”¨æ¨¡æ“¬æ•¸æ“šå±•ç¤ºåŠŸèƒ½ã€‚è¼¸å…¥ Key å¾Œå°‡è‡ªå‹•åˆ‡æ›ç‚ºçœŸå¯¦ç¿»è­¯ã€‚
                            </p>
                        </div>

                        <div>
                            <label className="block text-xs font-bold text-gray-700 mb-1 uppercase tracking-wider">Google Gemini API Key</label>
                            <input
                            type="password"
                            value={apiKey}
                            onChange={(e) => setApiKey(e.target.value)}
                            placeholder="è«‹åœ¨æ­¤è²¼ä¸Šæ‚¨çš„ API Key..."
                            className="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all text-sm"
                            />
                        </div>
                        
                        <div>
                            <label className="block text-xs font-bold text-gray-700 mb-1 uppercase tracking-wider">
                            API Proxy URL <span className="font-normal text-gray-400 normal-case">(é¸å¡«)</span>
                            </label>
                            <input
                            type="text"
                            value={baseUrl}
                            onChange={(e) => setBaseUrl(e.target.value)}
                            placeholder="https://generativelanguage.googleapis.com"
                            className="w-full border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all bg-gray-50"
                            />
                        </div>
                        </div>

                        <button
                        onClick={() => setShowSettings(false)}
                        className="w-full bg-indigo-600 text-white py-3.5 rounded-xl font-bold shadow-lg hover:bg-indigo-700 transition-colors mt-4"
                        >
                        å„²å­˜ä¸¦è¿”å›
                        </button>
                    </div>
                    )}

                    {/* Main Content */}
                    <main className="flex-1 overflow-y-auto p-4 flex flex-col gap-4 scroll-smooth">
                    
                    {/* Camera View */}
                    {isCameraOpen && (
                        <div className="fixed inset-0 bg-black z-40 flex flex-col animate-fade-in">
                        <div className="flex-1 relative bg-black flex items-center justify-center">
                            {!streamRef.current && <div className="text-white/50 text-sm">æ­£åœ¨å•Ÿå‹•ç›¸æ©Ÿ...</div>}
                            <video 
                            ref={videoRef} 
                            autoPlay 
                            playsInline 
                            className="w-full h-full object-cover"
                            />
                            <button 
                            onClick={stopCamera} 
                            className="absolute top-4 right-4 bg-black/50 text-white p-3 rounded-full hover:bg-black/70 transition-all backdrop-blur-sm"
                            >
                            <X className="w-6 h-6" />
                            </button>
                        </div>
                        <div className="bg-black/90 p-8 flex justify-center pb-12">
                            <button 
                            onClick={captureImage}
                            className="w-20 h-20 bg-white rounded-full border-4 border-gray-400 hover:border-indigo-500 hover:scale-105 transition-all shadow-[0_0_20px_rgba(255,255,255,0.3)] flex items-center justify-center relative"
                            >
                            <div className="w-16 h-16 bg-white rounded-full border-2 border-black/10"></div>
                            </button>
                        </div>
                        </div>
                    )}

                    {/* Image Preview & Actions */}
                    {imgSrc && !isCameraOpen && !result && (
                        <div className="flex flex-col gap-4 animate-slide-up">
                        <div className="relative rounded-2xl overflow-hidden shadow-lg border border-gray-200 bg-gray-100 group">
                            <img src={imgSrc} alt="Preview" className="w-full max-h-[50vh] object-contain mx-auto" />
                            <button 
                            onClick={() => setImgSrc(null)}
                            className="absolute top-2 right-2 bg-black/60 text-white p-2 rounded-full hover:bg-red-500 transition-colors backdrop-blur-sm"
                            >
                            <X className="w-4 h-4" />
                            </button>
                            <div className="absolute bottom-0 inset-x-0 bg-gradient-to-t from-black/50 to-transparent p-2">
                            <p className="text-white text-xs text-center">{apiKey ? 'Ready to analyze' : 'Demo Mode Ready'}</p>
                            </div>
                        </div>

                        <div className="space-y-3">
                            <button
                            onClick={analyzeImage}
                            disabled={loading}
                            className={`w-full text-white py-4 rounded-xl font-bold text-lg shadow-lg transform hover:-translate-y-1 transition-all flex justify-center items-center gap-2
                                ${apiKey 
                                ? 'bg-gradient-to-r from-indigo-600 to-purple-600 shadow-indigo-200' 
                                : 'bg-gradient-to-r from-teal-500 to-emerald-500 shadow-teal-200'
                                }`}
                            >
                            {loading ? (
                                <>
                                <RefreshCw className="w-5 h-5 animate-spin" /> {apiKey ? 'AI åˆ†æä¸­...' : 'æ¨¡æ“¬åˆ†æä¸­...'}
                                </>
                            ) : (
                                <>
                                <Zap className="w-5 h-5" /> {apiKey ? 'é–‹å§‹ AI ç¿»è­¯' : 'æ¸¬è©¦ç¿»è­¯ (å… Key)'}
                                </>
                            )}
                            </button>
                            
                            {!apiKey && !loading && (
                            <p className="text-center text-xs text-gray-400">ç›®å‰ç‚ºæ¨¡æ“¬æ¸¬è©¦æ¨¡å¼ï¼Œä¸æœƒæ¶ˆè€— API Quota</p>
                            )}
                        </div>
                        
                        {loading && (
                            <div className="flex flex-col items-center justify-center py-8 space-y-3">
                            <div className="w-12 h-12 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin"></div>
                            <p className="text-indigo-600 font-medium animate-pulse text-sm">
                                {apiKey ? 'æ­£åœ¨è®€å–éŸ“æ–‡ä¸¦ç”Ÿæˆè¡¨æ ¼...' : 'æ­£åœ¨ç”¢ç”Ÿæ¨¡æ“¬çµæœ...'}
                            </p>
                            </div>
                        )}
                        </div>
                    )}

                    {/* Result Display */}
                    {result && (
                        <div className="flex flex-col gap-4 animate-slide-up pb-10">
                        {isDemoMode && (
                            <div className="bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-start gap-2 text-xs text-amber-800">
                            <Info className="w-4 h-4 mt-0.5 flex-shrink-0" />
                            <p>é€™æ˜¯<b>æ¨¡æ“¬æ¸¬è©¦çµæœ</b>ã€‚è‹¥è¦ç¿»è­¯æ‚¨ä¸Šå‚³çš„çœŸå¯¦åœ–ç‰‡ï¼Œè«‹é»æ“Šå³ä¸Šè§’ã€Œè¨­å®š Keyã€è¼¸å…¥ API Keyã€‚</p>
                            </div>
                        )}

                        <div className="bg-white rounded-2xl shadow-xl border border-indigo-100 overflow-hidden ring-1 ring-black/5">
                            <div className="bg-gradient-to-r from-indigo-50 to-white p-4 border-b border-indigo-100 flex items-center justify-between">
                            <h3 className="font-bold text-indigo-900 flex items-center gap-2">
                                <Table className="w-5 h-5 text-indigo-600" /> ç¿»è­¯æ‘˜è¦
                            </h3>
                            <span className={`text-[10px] px-2 py-0.5 rounded-full font-medium border ${isDemoMode ? 'bg-amber-100 text-amber-700 border-amber-200' : 'bg-indigo-100 text-indigo-700 border-indigo-200'}`}>
                                {isDemoMode ? 'TEST DATA' : 'AI GENERATED'}
                            </span>
                            </div>
                            <div className="p-5">
                            <MarkdownDisplay content={result} />
                            </div>
                        </div>

                        <button
                            onClick={resetAll}
                            className="w-full bg-white text-gray-600 border border-gray-300 py-3.5 rounded-xl font-semibold hover:bg-gray-50 hover:text-indigo-600 hover:border-indigo-300 transition-all shadow-sm"
                        >
                            æ‹æ”ä¸‹ä¸€å¼µ
                        </button>
                        </div>
                    )}

                    {/* Initial State / Empty State */}
                    {!imgSrc && !isCameraOpen && (
                        <div className="flex-1 flex flex-col justify-center items-center gap-8 py-10 animate-fade-in">
                        <div className="text-center space-y-4 px-6">
                            <div className="relative inline-block">
                            <div className="w-24 h-24 bg-gradient-to-tr from-indigo-100 to-white text-indigo-600 rounded-[2rem] mx-auto flex items-center justify-center shadow-xl border border-white">
                                <ImageIcon className="w-10 h-10" />
                            </div>
                            <div className="absolute -bottom-2 -right-2 bg-green-500 text-white text-[10px] px-2 py-1 rounded-full shadow-md">
                                Ready
                            </div>
                            </div>
                            
                            <div>
                            <h3 className="text-2xl font-bold text-gray-800 mb-2">éŸ“æ–‡å½±åƒç¿»è­¯</h3>
                            <p className="text-gray-500 text-sm leading-relaxed max-w-[260px] mx-auto">
                                æ‹ä¸‹èœå–®æˆ–è·¯æ¨™ï¼ŒAI è‡ªå‹•ç¿»è­¯ä¸¦æ•´ç†æˆè¡¨æ ¼ã€‚<br/>
                                <span className="text-indigo-400 text-xs">(å… Key å¯è©¦ç”¨æ¨¡æ“¬æ¨¡å¼)</span>
                            </p>
                            </div>
                        </div>

                        <div className="w-full space-y-3 px-6 max-w-sm">
                            <button
                            onClick={startCamera}
                            className="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold shadow-lg shadow-indigo-200 hover:bg-indigo-700 hover:shadow-xl hover:-translate-y-0.5 transition-all flex items-center justify-center gap-3"
                            >
                            <Camera className="w-5 h-5" /> é–‹å•Ÿç›¸æ©Ÿ
                            </button>
                            
                            <div className="relative group">
                            <input
                                type="file"
                                accept="image/*"
                                onChange={handleFileUpload}
                                className="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"
                            />
                            <button className="w-full bg-white text-gray-700 py-4 rounded-xl font-bold border-2 border-dashed border-gray-300 group-hover:border-indigo-400 group-hover:bg-indigo-50 transition-all flex items-center justify-center gap-3">
                                <Upload className="w-5 h-5 text-gray-400 group-hover:text-indigo-500" /> å¾ç›¸ç°¿ä¸Šå‚³
                            </button>
                            </div>
                        </div>
                        </div>
                    )}

                    {/* Error Message */}
                    {error && (
                        <div className="bg-red-50 text-red-600 p-4 rounded-xl text-sm flex items-start gap-3 border border-red-100 animate-shake shadow-sm mx-4">
                        <div className="bg-red-100 p-1.5 rounded-full flex-shrink-0">
                            <X className="w-4 h-4" />
                        </div>
                        <div className="flex-1">
                            <span className="font-bold block mb-1">ç™¼ç”ŸéŒ¯èª¤</span>
                            {error}
                        </div>
                        </div>
                    )}

                    </main>
                </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
